{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/nginx-setting","result":{"data":{"markdownRemark":{"id":"889b9d0a-249c-5ef3-8e22-602a438b3a24","html":"<h1 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h1>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo apt-get update</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo apt install nginx</code></pre></div>\n<h1 id=\"설정\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%A0%95\" aria-label=\"설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설정</h1>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo vi /etc/nginx/sites-available/nginx.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n    listen 80;\n    server_name [Public IP주소 or 도메인];\n\n    charset utf-8;\n    client_max_body_size 100M;\n\n    location / {\n        real_ip_header X-Forwarded-For;\n        set_real_ip_from 0.0.0.0/0;\n\n        log_format custom '[$time_local] $remote_addr - [$status] \"$request_time\" - \"$request\"';\n        access_log /home/ubuntu/logs/nginx-access/access.log custom;\n        error_log  /home/ubuntu/logs/nginx-error/error.log;\n\n        include proxy_params;\n        proxy_pass http://unix:/run/gunicorn.sock;\n    }\n}</code></pre></div>\n<h1 id=\"nginx-문법-오류-확인\" style=\"position:relative;\"><a href=\"#nginx-%EB%AC%B8%EB%B2%95-%EC%98%A4%EB%A5%98-%ED%99%95%EC%9D%B8\" aria-label=\"nginx 문법 오류 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nginx 문법 오류 확인</h1>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo nginx -t</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful</code></pre></div>\n<h1 id=\"심볼릭-링크-설정\" style=\"position:relative;\"><a href=\"#%EC%8B%AC%EB%B3%BC%EB%A6%AD-%EB%A7%81%ED%81%AC-%EC%84%A4%EC%A0%95\" aria-label=\"심볼릭 링크 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>심볼릭 링크 설정</h1>\n<p>에러나면 -f 옵션을 붙여서 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo ln -s /etc/nginx/sites-available/nginx.conf /etc/nginx/sites-enabled/nginx.conf</code></pre></div>\n<h1 id=\"실행\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%ED%96%89\" aria-label=\"실행 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실행</h1>\n<ul>\n<li>nginx 서비스 재시작</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo systemctl restart nginx.service</code></pre></div>\n<ul>\n<li>nginx 서비스 상태 확인</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo systemctl status nginx.service</code></pre></div>\n<h1 id=\"sslhttps-적용\" style=\"position:relative;\"><a href=\"#sslhttps-%EC%A0%81%EC%9A%A9\" aria-label=\"sslhttps 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SSL(HTTPS) 적용</h1>\n<ol>\n<li>도메인 인증서, 체인 인증서, 루트 인증서 파일 합치기</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">cat [도메인 인증서] [체인 인증서] [루트 인증서] &gt; [새로운 파일명.pem]</code></pre></div>\n<ol start=\"2\">\n<li>개인 키 암호 해제</li>\n</ol>\n<blockquote>\n<p>(----BEGIN RSA PRIVATE KEY---— 로 되어있으면 ----BEGIN PRIVATE KEY---—로 암호 해제를 해줘야 함)</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">openssl rsa -in [개인키 파일] -out public.pem</code></pre></div>\n<ol start=\"3\">\n<li>nginx 설정</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo vi /etc/nginx/sites-available/nginx.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">server {\n    listen 80;\n    server_name 도메인;\n\n    charset utf-8;\n    client_max_body_size 100M;\n\n    location / {\n        real_ip_header X-Forwarded-For;\n        set_real_ip_from 0.0.0.0/0;\n\n        access_log /home/ubuntu/logs/nginx/nginx_access.log;\n        error_log  /home/ubuntu/logs/nginx/nginx_error.log;\n\n        include proxy_params;\n        proxy_pass http://unix:/run/gunicorn.sock;\n    }\n    # http로 접근했을 때 https로 리다이렉트\n    return 301 https://$host$request_uri;\n}\n\n# 블록 추가\nserver {\n    listen 443 ssl;\n    server_name 도메인;\n\n    ssl_certificate [도메인 인증서, 체인 인증서, 루트 인증서 합친 파일의 경로];\n    ssl_certificate_key [암호 해제한 개인 키 파일 경로];\n\n    ssl_prefer_server_ciphers on;\n    ssl_session_cache shared:SSL:1m;\n    ssl_session_timeout 5m;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    charset utf-8;\n    client_max_body_size 100M;\n\n    location / {\n        real_ip_header X-Forwarded-For;\n        set_real_ip_from 0.0.0.0/0;\n\n        log_format custom &#39;[$time_local] $remote_addr - [$status] &quot;$request_time&quot; - &quot;$request&quot;&#39;;\n        access_log /home/ubuntu/logs/nginx-access/access.log custom;\n        error_log  /home/ubuntu/logs/nginx-error/error.log;\n\n        include proxy_params;\n        proxy_pass http://unix:/run/gunicorn.sock;\n    }\n}</code></pre></div>\n<hr>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo vi /etc/nginx/nginx.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">user root;\nworker_processes auto;\npid /var/run/nginx.pid;\ninclude /etc/nginx/modules-enabled/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format custom '[$time_local] $remote_addr - [$status] \"$request_time\" - \"$request\"';\n    access_log /home/ubuntu/logs/nginx-access/access.log custom;\n    error_log  /home/ubuntu/logs/nginx-error/error.log;\n\n    include /etc/nginx/mime.types;\n    include /etc/nginx/conf.d/*.conf;  // server파일 분리해서 가져옴\n}</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo vi /etc/nginx/sites-available/nginx.conf</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server {\n    listen 80;\n    server_name [Public IP주소 or 도메인];\n\n    charset utf-8;\n    client_max_body_size 100M;\n\n    location / {\n        real_ip_header X-Forwarded-For;\n        set_real_ip_from 0.0.0.0/0;\n\n        include proxy_params;\n        proxy_pass http://unix:/run/gunicorn.sock;\n    }\n}</code></pre></div>\n<h3 id=\"심볼릭-링크-설정-1\" style=\"position:relative;\"><a href=\"#%EC%8B%AC%EB%B3%BC%EB%A6%AD-%EB%A7%81%ED%81%AC-%EC%84%A4%EC%A0%95-1\" aria-label=\"심볼릭 링크 설정 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>심볼릭 링크 설정</h3>\n<p>에러나면 -f 옵션을 붙여서 실행</p>\n<div class=\"gatsby-highlight\" data-language=\"commandline\"><pre class=\"language-commandline\"><code class=\"language-commandline\">sudo ln -s /etc/nginx/sites-available/nginx.conf /etc/nginx/sites-enabled/nginx.conf</code></pre></div>","fields":{"slug":"/posts/2024//posts/nginx-setting","tagSlugs":["/tag/nginx/","/tag/deploy/"]},"frontmatter":{"date":"2024-01-19","description":"Nginx Setting","tags":["nginx","deploy"],"title":"Nginx 설정","socialImage":null}}},"pageContext":{"slug":"/posts/2024//posts/nginx-setting"}},"staticQueryHashes":["251939775","2764776372","401334301"]}