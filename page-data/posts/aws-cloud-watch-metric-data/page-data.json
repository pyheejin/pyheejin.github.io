{"componentChunkName":"component---src-templates-post-template-post-template-tsx","path":"/posts/aws-cloud-watch-metric-data","result":{"data":{"markdownRemark":{"id":"0b11651a-6be5-5245-853f-365bae18a581","html":"<ul>\n<li>get_metric_data() : AWS CloudWatch Metrics API를 사용하여 하나 이상의 메트릭 데이터 포인트 집합을 검색하는 함수</li>\n<li>MetricDataQueries : CloudWatch 메트릭 데이터를 조회하기 위한 필수 매개변수</li>\n<li>Id                : 이 요청을 식별하기 위한 문자열 ID</li>\n<li>MetricStat        : 조회할 메트릭에 대한 정보를 담은 객체</li>\n<li>Metric            : 조회할 메트릭에 대한 정보를 담은 객체</li>\n<li>Namespace         : 조회할 메트릭의 네임스페이스</li>\n<li>MetricName        : 조회할 메트릭의 이름</li>\n<li>Dimensions        : 조회할 메트릭의 디멘션 정보(옵션)</li>\n<li>Period            : 메트릭 데이터의 간격을 초 단위로 지정</li>\n<li>Stat              : 조회할 메트릭의 통계 종류를 지정(옵션 : Sum, Average, Maximum, Minimum 등)</li>\n<li>Unit              : 조회할 메트릭의 단위를 지정(옵션 : igabits/Second, Gigabits, Percent, Terabits, Bits, Kilobits, Megabytes/Second, Kilobytes, Megabits/Second, Terabytes, Bytes, Count, Gigabytes, Milliseconds, Count/Second, Gigabytes/Second, None, Terabytes/Second, Bytes/Second, Megabits, Kilobytes/Second, Megabytes, Microseconds, Kilobits/Second, Terabits/Second, Bits/Second, Seconds)</li>\n<li>ReturnData        : 조회 결과를 반환할 지 여부를 지정</li>\n<li>StartTime         : 메트릭 데이터를 가져올 시작 시간 지정</li>\n<li>EndTime           : 메트릭 데이터를 가져올 끝 시간 지정</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime<span class=\"token punctuation\">,</span> timedelta\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">cloud_watch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n    instance_list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'namespace'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'AWS/EC2'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'dimension'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'InstanceId'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'instance name'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'instance id'</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'namespace'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'AWS/RDS'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'dimension'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'DBInstanceIdentifier'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'rds name'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'rds name'</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n\n    REGION_NAME <span class=\"token operator\">=</span> <span class=\"token string\">'ap-northeast-2'</span>\n\n    <span class=\"token comment\"># CloudWatch 클라이언트 생성</span>\n    session <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>Session<span class=\"token punctuation\">(</span>\n        aws_access_key_id<span class=\"token operator\">=</span>ACCESS_KEY<span class=\"token punctuation\">,</span>\n        aws_secret_access_key<span class=\"token operator\">=</span>SECRET_KEY<span class=\"token punctuation\">,</span>\n        region_name<span class=\"token operator\">=</span>REGION_NAME\n    <span class=\"token punctuation\">)</span>\n\n    cloudwatch <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'cloudwatch'</span><span class=\"token punctuation\">)</span>\n\n    now <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    start_time <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>now <span class=\"token operator\">-</span> timedelta<span class=\"token punctuation\">(</span>hours<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>isoformat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'+09:00'</span>\n    end_time <span class=\"token operator\">=</span> now<span class=\"token punctuation\">.</span>isoformat<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> instance <span class=\"token keyword\">in</span> instance_list<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># 메트릭 데이터 조회</span>\n        metric_data <span class=\"token operator\">=</span> cloudwatch<span class=\"token punctuation\">.</span>get_metric_data<span class=\"token punctuation\">(</span>\n            MetricDataQueries<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span>\n                    <span class=\"token string\">'Id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'m1'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">'MetricStat'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token string\">'Metric'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n                            <span class=\"token string\">'Namespace'</span><span class=\"token punctuation\">:</span> instance<span class=\"token punctuation\">[</span><span class=\"token string\">'namespace'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token string\">'MetricName'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'CPUUtilization'</span><span class=\"token punctuation\">,</span>\n                            <span class=\"token string\">'Dimensions'</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n                                <span class=\"token punctuation\">{</span>\n                                    <span class=\"token string\">'Name'</span><span class=\"token punctuation\">:</span> instance<span class=\"token punctuation\">[</span><span class=\"token string\">'dimension'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                                    <span class=\"token string\">'Value'</span><span class=\"token punctuation\">:</span> instance<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span>\n                                <span class=\"token punctuation\">}</span>\n                            <span class=\"token punctuation\">]</span>\n                        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">'Period'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">'Stat'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Average'</span><span class=\"token punctuation\">,</span>\n                        <span class=\"token string\">'Unit'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Percent'</span>\n                    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token string\">'ReturnData'</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            StartTime<span class=\"token operator\">=</span>start_time<span class=\"token punctuation\">,</span>\n            EndTime<span class=\"token operator\">=</span>end_time\n        <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> metric_data<span class=\"token punctuation\">[</span><span class=\"token string\">'MetricDataResults'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'Values'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">is</span> <span class=\"token keyword\">not</span> <span class=\"token boolean\">None</span><span class=\"token punctuation\">:</span>\n            values <span class=\"token operator\">=</span> metric_data<span class=\"token punctuation\">[</span><span class=\"token string\">'MetricDataResults'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Values'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                value <span class=\"token operator\">=</span> <span class=\"token builtin\">round</span><span class=\"token punctuation\">(</span>values<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n                msg <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f\"[</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>instance<span class=\"token punctuation\">[</span><span class=\"token string\">'namespace'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> CPUUtilization] </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>instance<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span><span class=\"token string\"> : </span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span></span><span class=\"token string\">%\"</span></span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                value <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n            data <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'instance_id'</span><span class=\"token punctuation\">:</span> instance<span class=\"token punctuation\">[</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'instance_name'</span><span class=\"token punctuation\">:</span> instance<span class=\"token punctuation\">[</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'value'</span><span class=\"token punctuation\">:</span> value<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'msg'</span><span class=\"token punctuation\">:</span> msg\n            <span class=\"token punctuation\">}</span>\n            result<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> result</code></pre></div>","fields":{"slug":"/posts/2024//posts/aws-cloud-watch-metric-data","tagSlugs":["/tag/aws/","/tag/cloudwatch/","/tag/metric/","/tag/boto3/"]},"frontmatter":{"date":"2024-01-24","description":"aws get metric data with boto3","tags":["aws","cloudwatch","metric","boto3"],"title":"Boto3로 CloudWatch에서 메트릭 데이터 가져오기","socialImage":null}}},"pageContext":{"slug":"/posts/2024//posts/aws-cloud-watch-metric-data"}},"staticQueryHashes":["251939775","2764776372","401334301"]}